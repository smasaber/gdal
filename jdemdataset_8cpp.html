<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.8"/>
<title>GDAL: Sample Driver: jdemdataset.cpp</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">GDAL
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.8 -->
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li class="current"><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li><a href="usergroup0.html"><span>Download</span></a></li>
      <li><a href="https://github.com/OSGeo/gdal/issues/"><span>Issue&#160;Tracker</span></a></li>
    </ul>
  </div>
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">Sample Driver: jdemdataset.cpp </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><div class="fragment"><div class="line"><span class="comment">/******************************************************************************</span></div>
<div class="line"><span class="comment"> *</span></div>
<div class="line"><span class="comment"> * Project:  JDEM Reader</span></div>
<div class="line"><span class="comment"> * Purpose:  All code for Japanese DEM Reader</span></div>
<div class="line"><span class="comment"> * Author:   Frank Warmerdam, warmerdam@pobox.com</span></div>
<div class="line"><span class="comment"> *</span></div>
<div class="line"><span class="comment"> ******************************************************************************</span></div>
<div class="line"><span class="comment"> * Copyright (c) 2000, Frank Warmerdam &lt;warmerdam@pobox.com&gt;</span></div>
<div class="line"><span class="comment"> * Copyright (c) 2009-2012, Even Rouault &lt;even dot rouault at mines-paris dot org&gt;</span></div>
<div class="line"><span class="comment"> *</span></div>
<div class="line"><span class="comment"> * Permission is hereby granted, free of charge, to any person obtaining a</span></div>
<div class="line"><span class="comment"> * copy of this software and associated documentation files (the &quot;Software&quot;),</span></div>
<div class="line"><span class="comment"> * to deal in the Software without restriction, including without limitation</span></div>
<div class="line"><span class="comment"> * the rights to use, copy, modify, merge, publish, distribute, sublicense,</span></div>
<div class="line"><span class="comment"> * and/or sell copies of the Software, and to permit persons to whom the</span></div>
<div class="line"><span class="comment"> * Software is furnished to do so, subject to the following conditions:</span></div>
<div class="line"><span class="comment"> *</span></div>
<div class="line"><span class="comment"> * The above copyright notice and this permission notice shall be included</span></div>
<div class="line"><span class="comment"> * in all copies or substantial portions of the Software.</span></div>
<div class="line"><span class="comment"> *</span></div>
<div class="line"><span class="comment"> * THE SOFTWARE IS PROVIDED &quot;AS IS&quot;, WITHOUT WARRANTY OF ANY KIND, EXPRESS</span></div>
<div class="line"><span class="comment"> * OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,</span></div>
<div class="line"><span class="comment"> * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL</span></div>
<div class="line"><span class="comment"> * THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER</span></div>
<div class="line"><span class="comment"> * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING</span></div>
<div class="line"><span class="comment"> * FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER</span></div>
<div class="line"><span class="comment"> * DEALINGS IN THE SOFTWARE.</span></div>
<div class="line"><span class="comment"> ****************************************************************************/</span></div>
<div class="line"></div>
<div class="line"><span class="preprocessor">#include &quot;<a class="code" href="cpl__port_8h.html">cpl_port.h</a>&quot;</span></div>
<div class="line"><span class="preprocessor">#include &quot;gdal_frmts.h&quot;</span></div>
<div class="line"><span class="preprocessor">#include &quot;gdal_pam.h&quot;</span></div>
<div class="line"></div>
<div class="line"><span class="preprocessor">#include &lt;algorithm&gt;</span></div>
<div class="line"></div>
<div class="line">CPL_CVSID(<span class="stringliteral">&quot;$Id$&quot;</span>)</div>
<div class="line"></div>
<div class="line"><span class="comment">/************************************************************************/</span></div>
<div class="line"><span class="comment">/*                            JDEMGetField()                            */</span></div>
<div class="line"><span class="comment">/************************************************************************/</span></div>
<div class="line"></div>
<div class="line">static <span class="keywordtype">int</span> JDEMGetField( const <span class="keywordtype">char</span> *pszField, <span class="keywordtype">int</span> nWidth )</div>
<div class="line"></div>
<div class="line">{</div>
<div class="line">    <span class="keywordtype">char</span> szWork[32] = {};</div>
<div class="line">    <a class="code" href="cpl__error_8h.html#a40ae27078f2a969a445daa022405cf72">CPLAssert</a>(nWidth &lt; static_cast&lt;int&gt;(<span class="keyword">sizeof</span>(szWork)));</div>
<div class="line"></div>
<div class="line">    strncpy(szWork, pszField, nWidth);</div>
<div class="line">    szWork[nWidth] = <span class="charliteral">&#39;\0&#39;</span>;</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">return</span> atoi(szWork);</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="comment">/************************************************************************/</span></div>
<div class="line"><span class="comment">/*                            JDEMGetAngle()                            */</span></div>
<div class="line"><span class="comment">/************************************************************************/</span></div>
<div class="line"></div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">double</span> JDEMGetAngle( <span class="keyword">const</span> <span class="keywordtype">char</span> *pszField )</div>
<div class="line"></div>
<div class="line">{</div>
<div class="line">    <span class="keyword">const</span> <span class="keywordtype">int</span> nAngle = JDEMGetField(pszField, 7);</div>
<div class="line"></div>
<div class="line">    <span class="comment">// Note, this isn&#39;t very general purpose, but it would appear</span></div>
<div class="line">    <span class="comment">// from the field widths that angles are never negative.  Nice</span></div>
<div class="line">    <span class="comment">// to be a country in the &quot;first quadrant&quot;.</span></div>
<div class="line"></div>
<div class="line">    <span class="keyword">const</span> <span class="keywordtype">int</span> nDegree = nAngle / 10000;</div>
<div class="line">    <span class="keyword">const</span> <span class="keywordtype">int</span> nMin = (nAngle / 100) % 100;</div>
<div class="line">    <span class="keyword">const</span> <span class="keywordtype">int</span> nSec = nAngle % 100;</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">return</span> nDegree + nMin / 60.0 + nSec / 3600.0;</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="comment">/************************************************************************/</span></div>
<div class="line"><span class="comment">/* ==================================================================== */</span></div>
<div class="line"><span class="comment">/*                              JDEMDataset                             */</span></div>
<div class="line"><span class="comment">/* ==================================================================== */</span></div>
<div class="line"><span class="comment">/************************************************************************/</span></div>
<div class="line"></div>
<div class="line"><span class="keyword">class </span>JDEMRasterBand;</div>
<div class="line"></div>
<div class="line"><span class="keyword">class </span>JDEMDataset : <span class="keyword">public</span> <a class="code" href="classGDALPamDataset.html">GDALPamDataset</a></div>
<div class="line">{</div>
<div class="line">    <span class="keyword">friend</span> <span class="keyword">class </span>JDEMRasterBand;</div>
<div class="line"></div>
<div class="line">    <a class="code" href="cpl__vsi_8h.html#af1b1400e402360b38304de2b13d16c14">VSILFILE</a>    *fp;</div>
<div class="line">    <a class="code" href="cpl__port_8h.html#ae7fbc84d3d1f7a40973be07382e28401">GByte</a>       abyHeader[1012];</div>
<div class="line"></div>
<div class="line">  <span class="keyword">public</span>:</div>
<div class="line">                     JDEMDataset();</div>
<div class="line">                    ~JDEMDataset();</div>
<div class="line"></div>
<div class="line">    <span class="keyword">static</span> <a class="code" href="classGDALDataset.html">GDALDataset</a> *<a class="code" href="classGDALDataset.html#a5379df6aeeebe76a985365acaeab756d">Open</a>( <a class="code" href="classGDALOpenInfo.html">GDALOpenInfo</a> * );</div>
<div class="line">    <span class="keyword">static</span> <span class="keywordtype">int</span> Identify( <a class="code" href="classGDALOpenInfo.html">GDALOpenInfo</a> * );</div>
<div class="line"></div>
<div class="line">    <a class="code" href="cpl__error_8h.html#a463ba7c7202a505416ff95b1aeefa2de">CPLErr</a> <a class="code" href="classGDALPamDataset.html#ac080c8a42a6cddab42bc4fd21ac49bf6">GetGeoTransform</a>( <span class="keywordtype">double</span> * padfTransform ) <span class="keyword">override</span>;</div>
<div class="line">    <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="classGDALPamDataset.html#a1a42a2a51d01b274e9871397317c577f">GetProjectionRef</a>() <span class="keyword">override</span>;</div>
<div class="line">};</div>
<div class="line"></div>
<div class="line"><span class="comment">/************************************************************************/</span></div>
<div class="line"><span class="comment">/* ==================================================================== */</span></div>
<div class="line"><span class="comment">/*                            JDEMRasterBand                             */</span></div>
<div class="line"><span class="comment">/* ==================================================================== */</span></div>
<div class="line"><span class="comment">/************************************************************************/</span></div>
<div class="line"></div>
<div class="line"><span class="keyword">class </span>JDEMRasterBand : <span class="keyword">public</span> <a class="code" href="classGDALPamRasterBand.html">GDALPamRasterBand</a></div>
<div class="line">{</div>
<div class="line">    <span class="keyword">friend</span> <span class="keyword">class </span>JDEMDataset;</div>
<div class="line"></div>
<div class="line">    <span class="keywordtype">int</span>          nRecordSize;</div>
<div class="line">    <span class="keywordtype">char</span>        *pszRecord;</div>
<div class="line">    <span class="keywordtype">bool</span>         bBufferAllocFailed;</div>
<div class="line"></div>
<div class="line">  <span class="keyword">public</span>:</div>
<div class="line">                JDEMRasterBand( JDEMDataset *, <span class="keywordtype">int</span> );</div>
<div class="line">    <span class="keyword">virtual</span> ~JDEMRasterBand();</div>
<div class="line"></div>
<div class="line">    <span class="keyword">virtual</span> <a class="code" href="cpl__error_8h.html#a463ba7c7202a505416ff95b1aeefa2de">CPLErr</a> <a class="code" href="classGDALRasterBand.html#aa48009722cbd31558f70233c62d94602">IReadBlock</a>( <span class="keywordtype">int</span>, <span class="keywordtype">int</span>, <span class="keywordtype">void</span> * ) <span class="keyword">override</span>;</div>
<div class="line">};</div>
<div class="line"></div>
<div class="line"><span class="comment">/************************************************************************/</span></div>
<div class="line"><span class="comment">/*                           JDEMRasterBand()                            */</span></div>
<div class="line"><span class="comment">/************************************************************************/</span></div>
<div class="line"></div>
<div class="line">JDEMRasterBand::JDEMRasterBand( JDEMDataset *poDSIn, <span class="keywordtype">int</span> nBandIn ) :</div>
<div class="line">    <span class="comment">// Cannot overflow as nBlockXSize &lt;= 999.</span></div>
<div class="line">    nRecordSize(poDSIn-&gt;GetRasterXSize() * 5 + 9 + 2),</div>
<div class="line">    pszRecord(nullptr),</div>
<div class="line">    bBufferAllocFailed(false)</div>
<div class="line">{</div>
<div class="line">    poDS = poDSIn;</div>
<div class="line">    nBand = nBandIn;</div>
<div class="line"></div>
<div class="line">    eDataType = <a class="code" href="gdal_8h.html#a22e22ce0a55036a96f652765793fb7a4af5cbd2f96abffd9ac061fc0dced5cbba">GDT_Float32</a>;</div>
<div class="line"></div>
<div class="line">    nBlockXSize = poDS-&gt;GetRasterXSize();</div>
<div class="line">    nBlockYSize = 1;</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="comment">/************************************************************************/</span></div>
<div class="line"><span class="comment">/*                          ~JDEMRasterBand()                            */</span></div>
<div class="line"><span class="comment">/************************************************************************/</span></div>
<div class="line"></div>
<div class="line">JDEMRasterBand::~JDEMRasterBand() { <a class="code" href="cpl__vsi_8h.html#af26e15498e19c2a8169db924415ff7ab">VSIFree</a>(pszRecord); }</div>
<div class="line"></div>
<div class="line"><span class="comment">/************************************************************************/</span></div>
<div class="line"><span class="comment">/*                             IReadBlock()                             */</span></div>
<div class="line"><span class="comment">/************************************************************************/</span></div>
<div class="line"></div>
<div class="line"><a class="code" href="cpl__error_8h.html#a463ba7c7202a505416ff95b1aeefa2de">CPLErr</a> JDEMRasterBand::IReadBlock( <a class="code" href="cpl__port_8h.html#a60255b7e52d54325540177a96ef155e2">CPL_UNUSED</a> <span class="keywordtype">int</span> nBlockXOff,</div>
<div class="line">                                   <span class="keywordtype">int</span> nBlockYOff,</div>
<div class="line">                                   <span class="keywordtype">void</span> * pImage )</div>
<div class="line"></div>
<div class="line">{</div>
<div class="line">    JDEMDataset *poGDS = <span class="keyword">static_cast&lt;</span>JDEMDataset *<span class="keyword">&gt;</span>(poDS);</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">if</span> (pszRecord == <span class="keyword">nullptr</span>)</div>
<div class="line">    {</div>
<div class="line">        <span class="keywordflow">if</span> (bBufferAllocFailed)</div>
<div class="line">            <span class="keywordflow">return</span> CE_Failure;</div>
<div class="line"></div>
<div class="line">        pszRecord = <span class="keyword">static_cast&lt;</span><span class="keywordtype">char</span> *<span class="keyword">&gt;</span>(<a class="code" href="cpl__vsi_8h.html#aade5a8741eb3362f68b2c3ee2d1b3676">VSI_MALLOC_VERBOSE</a>(nRecordSize));</div>
<div class="line">        <span class="keywordflow">if</span> (pszRecord == <span class="keyword">nullptr</span>)</div>
<div class="line">        {</div>
<div class="line">            bBufferAllocFailed = <span class="keyword">true</span>;</div>
<div class="line">            <span class="keywordflow">return</span> CE_Failure;</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    CPL_IGNORE_RET_VAL(</div>
<div class="line">        <a class="code" href="cpl__vsi_8h.html#ab32d81e8bf69e8e6e87f0aadf0a490c3">VSIFSeekL</a>(poGDS-&gt;fp, 1011 + nRecordSize * nBlockYOff, SEEK_SET));</div>
<div class="line"></div>
<div class="line">    CPL_IGNORE_RET_VAL(<a class="code" href="cpl__vsi_8h.html#a3e64279a239eef70703efc09f43585e9">VSIFReadL</a>(pszRecord, 1, nRecordSize, poGDS-&gt;fp));</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">if</span>( !<a class="code" href="cpl__port_8h.html#a96b4fe28af61448f5ae7cb219601eee3">EQUALN</a>(reinterpret_cast&lt;char *&gt;(poGDS-&gt;abyHeader), pszRecord, 6) )</div>
<div class="line">    {</div>
<div class="line">        <a class="code" href="cpl__error_8h.html#afda4d86428c1c533449ae6a69cdf430d">CPLError</a>(CE_Failure, <a class="code" href="cpl__error_8h.html#a7151d0699caa1372a8566562390ff113">CPLE_AppDefined</a>,</div>
<div class="line">                 <span class="stringliteral">&quot;JDEM Scanline corrupt.  Perhaps file was not transferred &quot;</span></div>
<div class="line">                 <span class="stringliteral">&quot;in binary mode?&quot;</span>);</div>
<div class="line">        <span class="keywordflow">return</span> CE_Failure;</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">if</span>( JDEMGetField(pszRecord + 6, 3) != nBlockYOff + 1 )</div>
<div class="line">    {</div>
<div class="line">        <a class="code" href="cpl__error_8h.html#afda4d86428c1c533449ae6a69cdf430d">CPLError</a>(CE_Failure, <a class="code" href="cpl__error_8h.html#a7151d0699caa1372a8566562390ff113">CPLE_AppDefined</a>,</div>
<div class="line">                 <span class="stringliteral">&quot;JDEM scanline out of order, JDEM driver does not &quot;</span></div>
<div class="line">                 <span class="stringliteral">&quot;currently support partial datasets.&quot;</span>);</div>
<div class="line">        <span class="keywordflow">return</span> CE_Failure;</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">for</span>( <span class="keywordtype">int</span> i = 0; i &lt; nBlockXSize; i++ )</div>
<div class="line">        static_cast&lt;float *&gt;(pImage)[i] =</div>
<div class="line">            JDEMGetField(pszRecord + 9 + 5 * i, 5) * 0.1f;</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">return</span> CE_None;</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="comment">/************************************************************************/</span></div>
<div class="line"><span class="comment">/* ==================================================================== */</span></div>
<div class="line"><span class="comment">/*                              JDEMDataset                             */</span></div>
<div class="line"><span class="comment">/* ==================================================================== */</span></div>
<div class="line"><span class="comment">/************************************************************************/</span></div>
<div class="line"></div>
<div class="line"><span class="comment">/************************************************************************/</span></div>
<div class="line"><span class="comment">/*                            JDEMDataset()                             */</span></div>
<div class="line"><span class="comment">/************************************************************************/</span></div>
<div class="line"></div>
<div class="line">JDEMDataset::JDEMDataset() :</div>
<div class="line">    fp(nullptr)</div>
<div class="line">{</div>
<div class="line">    std::fill_n(abyHeader, <a class="code" href="cpl__port_8h.html#ae9341ba904cd96a6eb068ee18a9be963">CPL_ARRAYSIZE</a>(abyHeader), static_cast&lt;GByte&gt;(0));</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="comment">/************************************************************************/</span></div>
<div class="line"><span class="comment">/*                           ~JDEMDataset()                             */</span></div>
<div class="line"><span class="comment">/************************************************************************/</span></div>
<div class="line"></div>
<div class="line">JDEMDataset::~JDEMDataset()</div>
<div class="line"></div>
<div class="line">{</div>
<div class="line">    FlushCache();</div>
<div class="line">    <span class="keywordflow">if</span>( fp != <span class="keyword">nullptr</span> )</div>
<div class="line">        CPL_IGNORE_RET_VAL(<a class="code" href="cpl__vsi_8h.html#ae7fe3eb9b2988c5a3c74889697f87e45">VSIFCloseL</a>(fp));</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="comment">/************************************************************************/</span></div>
<div class="line"><span class="comment">/*                          GetGeoTransform()                           */</span></div>
<div class="line"><span class="comment">/************************************************************************/</span></div>
<div class="line"></div>
<div class="line"><a class="code" href="cpl__error_8h.html#a463ba7c7202a505416ff95b1aeefa2de">CPLErr</a> JDEMDataset::GetGeoTransform( <span class="keywordtype">double</span> *padfTransform )</div>
<div class="line"></div>
<div class="line">{</div>
<div class="line">    <span class="keyword">const</span> <span class="keywordtype">char</span> *psHeader = <span class="keyword">reinterpret_cast&lt;</span><span class="keywordtype">char</span> *<span class="keyword">&gt;</span>(abyHeader);</div>
<div class="line"></div>
<div class="line">    <span class="keyword">const</span> <span class="keywordtype">double</span> dfLLLat = JDEMGetAngle(psHeader + 29);</div>
<div class="line">    <span class="keyword">const</span> <span class="keywordtype">double</span> dfLLLong = JDEMGetAngle(psHeader + 36);</div>
<div class="line">    <span class="keyword">const</span> <span class="keywordtype">double</span> dfURLat = JDEMGetAngle(psHeader + 43);</div>
<div class="line">    <span class="keyword">const</span> <span class="keywordtype">double</span> dfURLong = JDEMGetAngle(psHeader + 50);</div>
<div class="line"></div>
<div class="line">    padfTransform[0] = dfLLLong;</div>
<div class="line">    padfTransform[3] = dfURLat;</div>
<div class="line">    padfTransform[1] = (dfURLong - dfLLLong) / GetRasterXSize();</div>
<div class="line">    padfTransform[2] = 0.0;</div>
<div class="line"></div>
<div class="line">    padfTransform[4] = 0.0;</div>
<div class="line">    padfTransform[5] = -1 * (dfURLat - dfLLLat) / GetRasterYSize();</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">return</span> CE_None;</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="comment">/************************************************************************/</span></div>
<div class="line"><span class="comment">/*                          GetProjectionRef()                          */</span></div>
<div class="line"><span class="comment">/************************************************************************/</span></div>
<div class="line"></div>
<div class="line"><span class="keyword">const</span> <span class="keywordtype">char</span> *JDEMDataset::GetProjectionRef()</div>
<div class="line"></div>
<div class="line">{</div>
<div class="line">    <span class="keywordflow">return</span></div>
<div class="line">        <span class="stringliteral">&quot;GEOGCS[\&quot;Tokyo\&quot;,DATUM[\&quot;Tokyo\&quot;,&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;SPHEROID[\&quot;Bessel 1841\&quot;,6377397.155,299.1528128,&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;AUTHORITY[\&quot;EPSG\&quot;,7004]],TOWGS84[-148,507,685,0,0,0,0],&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;AUTHORITY[\&quot;EPSG\&quot;,6301]],PRIMEM[\&quot;Greenwich\&quot;,0,&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;AUTHORITY[\&quot;EPSG\&quot;,8901]],UNIT[\&quot;DMSH\&quot;,0.0174532925199433,&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;AUTHORITY[\&quot;EPSG\&quot;,9108]],AUTHORITY[\&quot;EPSG\&quot;,4301]]&quot;</span>;</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="comment">/************************************************************************/</span></div>
<div class="line"><span class="comment">/*                              Identify()                              */</span></div>
<div class="line"><span class="comment">/************************************************************************/</span></div>
<div class="line"></div>
<div class="line"><span class="keywordtype">int</span> JDEMDataset::Identify( <a class="code" href="classGDALOpenInfo.html">GDALOpenInfo</a> *poOpenInfo )</div>
<div class="line"></div>
<div class="line">{</div>
<div class="line">    <span class="comment">// Confirm that the header has what appears to be dates in the</span></div>
<div class="line">    <span class="comment">// expected locations.  Sadly this is a relatively weak test.</span></div>
<div class="line">    <span class="keywordflow">if</span>( poOpenInfo-&gt;<a class="code" href="classGDALOpenInfo.html#af62c6ba9270758c340908885ebcf4c4d">nHeaderBytes</a> &lt; 50 )</div>
<div class="line">        <span class="keywordflow">return</span> FALSE;</div>
<div class="line"></div>
<div class="line">    <span class="comment">// Check if century values seem reasonable.</span></div>
<div class="line">    <span class="keyword">const</span> <span class="keywordtype">char</span> *psHeader = <span class="keyword">reinterpret_cast&lt;</span><span class="keywordtype">char</span> *<span class="keyword">&gt;</span>(poOpenInfo-&gt;<a class="code" href="classGDALOpenInfo.html#a2193ea49d916003baa90e75426309e10">pabyHeader</a>);</div>
<div class="line">    <span class="keywordflow">if</span>( (!<a class="code" href="cpl__port_8h.html#afbc02be985c2bb8451a765ad38b9dc8c">STARTS_WITH_CI</a>(psHeader + 11, <span class="stringliteral">&quot;19&quot;</span>) &amp;&amp;</div>
<div class="line">         !<a class="code" href="cpl__port_8h.html#afbc02be985c2bb8451a765ad38b9dc8c">STARTS_WITH_CI</a>(psHeader + 11, <span class="stringliteral">&quot;20&quot;</span>)) ||</div>
<div class="line">        (!<a class="code" href="cpl__port_8h.html#afbc02be985c2bb8451a765ad38b9dc8c">STARTS_WITH_CI</a>(psHeader + 15, <span class="stringliteral">&quot;19&quot;</span>) &amp;&amp;</div>
<div class="line">         !<a class="code" href="cpl__port_8h.html#afbc02be985c2bb8451a765ad38b9dc8c">STARTS_WITH_CI</a>(psHeader + 15, <span class="stringliteral">&quot;20&quot;</span>)) ||</div>
<div class="line">        (!<a class="code" href="cpl__port_8h.html#afbc02be985c2bb8451a765ad38b9dc8c">STARTS_WITH_CI</a>(psHeader + 19, <span class="stringliteral">&quot;19&quot;</span>) &amp;&amp;</div>
<div class="line">         !<a class="code" href="cpl__port_8h.html#afbc02be985c2bb8451a765ad38b9dc8c">STARTS_WITH_CI</a>(psHeader + 19, <span class="stringliteral">&quot;20&quot;</span>)) )</div>
<div class="line">    {</div>
<div class="line">        <span class="keywordflow">return</span> FALSE;</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">return</span> TRUE;</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="comment">/************************************************************************/</span></div>
<div class="line"><span class="comment">/*                                Open()                                */</span></div>
<div class="line"><span class="comment">/************************************************************************/</span></div>
<div class="line"></div>
<div class="line"><a class="code" href="classGDALDataset.html">GDALDataset</a> *JDEMDataset::Open( <a class="code" href="classGDALOpenInfo.html">GDALOpenInfo</a> *poOpenInfo )</div>
<div class="line"></div>
<div class="line">{</div>
<div class="line">    <span class="comment">// Confirm that the header is compatible with a JDEM dataset.</span></div>
<div class="line">    <span class="keywordflow">if</span> (!Identify(poOpenInfo))</div>
<div class="line">        <span class="keywordflow">return</span> <span class="keyword">nullptr</span>;</div>
<div class="line"></div>
<div class="line">    <span class="comment">// Confirm the requested access is supported.</span></div>
<div class="line">    <span class="keywordflow">if</span>( poOpenInfo-&gt;<a class="code" href="classGDALOpenInfo.html#a720dbd5edc6176843b2e73d21c9cf23c">eAccess</a> == <a class="code" href="gdal_8h.html#a045e3967c208993f70257bfd40c9f1d7a61c6081de474ef2a756982d3c53130a2">GA_Update</a> )</div>
<div class="line">    {</div>
<div class="line">        <a class="code" href="cpl__error_8h.html#afda4d86428c1c533449ae6a69cdf430d">CPLError</a>(CE_Failure, <a class="code" href="cpl__error_8h.html#a3a532186d9f9e2699aee57aab0648b5e">CPLE_NotSupported</a>,</div>
<div class="line">                 <span class="stringliteral">&quot;The JDEM driver does not support update access to existing &quot;</span></div>
<div class="line">                 <span class="stringliteral">&quot;datasets.&quot;</span>);</div>
<div class="line">        <span class="keywordflow">return</span> <span class="keyword">nullptr</span>;</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="comment">// Check that the file pointer from GDALOpenInfo* is available.</span></div>
<div class="line">    <span class="keywordflow">if</span>( poOpenInfo-&gt;<a class="code" href="classGDALOpenInfo.html#a90892bf145ec8347891e6eaa5c8cce4a">fpL</a> == <span class="keyword">nullptr</span> )</div>
<div class="line">    {</div>
<div class="line">        <span class="keywordflow">return</span> <span class="keyword">nullptr</span>;</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="comment">// Create a corresponding GDALDataset.</span></div>
<div class="line">    JDEMDataset *poDS = <span class="keyword">new</span> JDEMDataset();</div>
<div class="line"></div>
<div class="line">    <span class="comment">// Borrow the file pointer from GDALOpenInfo*.</span></div>
<div class="line">    poDS-&gt;fp = poOpenInfo-&gt;<a class="code" href="classGDALOpenInfo.html#a90892bf145ec8347891e6eaa5c8cce4a">fpL</a>;</div>
<div class="line">    poOpenInfo-&gt;<a class="code" href="classGDALOpenInfo.html#a90892bf145ec8347891e6eaa5c8cce4a">fpL</a> = <span class="keyword">nullptr</span>;</div>
<div class="line"></div>
<div class="line">    <span class="comment">// Read the header.</span></div>
<div class="line">    CPL_IGNORE_RET_VAL(<a class="code" href="cpl__vsi_8h.html#a3e64279a239eef70703efc09f43585e9">VSIFReadL</a>(poDS-&gt;abyHeader, 1, 1012, poDS-&gt;fp));</div>
<div class="line"></div>
<div class="line">    <span class="keyword">const</span> <span class="keywordtype">char</span> *psHeader = <span class="keyword">reinterpret_cast&lt;</span><span class="keywordtype">char</span> *<span class="keyword">&gt;</span>(poDS-&gt;abyHeader);</div>
<div class="line">    poDS-&gt;nRasterXSize = JDEMGetField(psHeader + 23, 3);</div>
<div class="line">    poDS-&gt;nRasterYSize = JDEMGetField(psHeader + 26, 3);</div>
<div class="line">    <span class="keywordflow">if</span>( poDS-&gt;nRasterXSize &lt;= 0 || poDS-&gt;nRasterYSize &lt;= 0 )</div>
<div class="line">    {</div>
<div class="line">        <a class="code" href="cpl__error_8h.html#afda4d86428c1c533449ae6a69cdf430d">CPLError</a>(CE_Failure, <a class="code" href="cpl__error_8h.html#a7151d0699caa1372a8566562390ff113">CPLE_AppDefined</a>,</div>
<div class="line">                 <span class="stringliteral">&quot;Invalid dimensions : %d x %d&quot;</span>,</div>
<div class="line">                 poDS-&gt;nRasterXSize, poDS-&gt;nRasterYSize);</div>
<div class="line">        <span class="keyword">delete</span> poDS;</div>
<div class="line">        <span class="keywordflow">return</span> <span class="keyword">nullptr</span>;</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="comment">// Create band information objects.</span></div>
<div class="line">    poDS-&gt;SetBand(1, <span class="keyword">new</span> JDEMRasterBand(poDS, 1));</div>
<div class="line"></div>
<div class="line">    <span class="comment">// Initialize any PAM information.</span></div>
<div class="line">    poDS-&gt;SetDescription(poOpenInfo-&gt;<a class="code" href="classGDALOpenInfo.html#ac4853cfc89944973b4811a7422d20837">pszFilename</a>);</div>
<div class="line">    poDS-&gt;TryLoadXML();</div>
<div class="line"></div>
<div class="line">    <span class="comment">// Check for overviews.</span></div>
<div class="line">    poDS-&gt;oOvManager.Initialize(poDS, poOpenInfo-&gt;<a class="code" href="classGDALOpenInfo.html#ac4853cfc89944973b4811a7422d20837">pszFilename</a>);</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">return</span> poDS;</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="comment">/************************************************************************/</span></div>
<div class="line"><span class="comment">/*                          GDALRegister_JDEM()                         */</span></div>
<div class="line"><span class="comment">/************************************************************************/</span></div>
<div class="line"></div>
<div class="line"><span class="keywordtype">void</span> GDALRegister_JDEM()</div>
<div class="line"></div>
<div class="line">{</div>
<div class="line">    <span class="keywordflow">if</span>( <a class="code" href="gdal_8h.html#ae8ae868eef1e4773283d137b0a1adfc4">GDALGetDriverByName</a>(<span class="stringliteral">&quot;JDEM&quot;</span>) != <span class="keyword">nullptr</span> )</div>
<div class="line">        <span class="keywordflow">return</span>;</div>
<div class="line"></div>
<div class="line">    <a class="code" href="classGDALDriver.html">GDALDriver</a> *poDriver = <span class="keyword">new</span> <a class="code" href="classGDALDriver.html">GDALDriver</a>();</div>
<div class="line"></div>
<div class="line">    poDriver-&gt;<a class="code" href="classGDALMajorObject.html#af334bc8d152f130a55783ea36938735b">SetDescription</a>(<span class="stringliteral">&quot;JDEM&quot;</span>);</div>
<div class="line">    poDriver-&gt;<a class="code" href="classGDALDriver.html#a65130ea5fe7ea188b9c666080ea4ad30">SetMetadataItem</a>(<a class="code" href="gdal_8h.html#a25e3a5b5d4d7bea0602f98b9e2ea050c">GDAL_DCAP_RASTER</a>, <span class="stringliteral">&quot;YES&quot;</span>);</div>
<div class="line">    poDriver-&gt;<a class="code" href="classGDALDriver.html#a65130ea5fe7ea188b9c666080ea4ad30">SetMetadataItem</a>(<a class="code" href="gdal_8h.html#a10963a08bd12bf29b36d8a23fb45471f">GDAL_DMD_LONGNAME</a>, <span class="stringliteral">&quot;Japanese DEM (.mem)&quot;</span>);</div>
<div class="line">    poDriver-&gt;<a class="code" href="classGDALDriver.html#a65130ea5fe7ea188b9c666080ea4ad30">SetMetadataItem</a>(<a class="code" href="gdal_8h.html#a85442e30b5313c88213ba87bf1b1ef05">GDAL_DMD_HELPTOPIC</a>, <span class="stringliteral">&quot;frmt_various.html#JDEM&quot;</span>);</div>
<div class="line">    poDriver-&gt;<a class="code" href="classGDALDriver.html#a65130ea5fe7ea188b9c666080ea4ad30">SetMetadataItem</a>(<a class="code" href="gdal_8h.html#aebd79c9d69709cc61c0329fa2298fe18">GDAL_DMD_EXTENSION</a>, <span class="stringliteral">&quot;mem&quot;</span>);</div>
<div class="line">    poDriver-&gt;<a class="code" href="classGDALDriver.html#a65130ea5fe7ea188b9c666080ea4ad30">SetMetadataItem</a>(<a class="code" href="gdal_8h.html#ad1f10e72385fed566d178dc3f0067fb8">GDAL_DCAP_VIRTUALIO</a>, <span class="stringliteral">&quot;YES&quot;</span>);</div>
<div class="line"></div>
<div class="line">    poDriver-&gt;pfnOpen = JDEMDataset::Open;</div>
<div class="line">    poDriver-&gt;pfnIdentify = JDEMDataset::Identify;</div>
<div class="line"></div>
<div class="line">    <a class="code" href="gdal__priv_8h.html#a4fb74d15f12b1ecd77bd8e5c48086590">GetGDALDriverManager</a>()-&gt;<a class="code" href="classGDALDriverManager.html#aa33cc86affa255ac37b463c129fbe49f">RegisterDriver</a>(poDriver);</div>
<div class="line">}</div>
</div><!-- fragment --> </div></div><!-- contents -->
<hr>
Generated for GDAL by
<a href="http://www.doxygen.org/index.html"><img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.8.8.
</body>
</html>
