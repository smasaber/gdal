<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.8"/>
<title>GDAL: GDAL Warp API Tutorial</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">GDAL
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.8 -->
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li class="current"><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li><a href="usergroup0.html"><span>Download</span></a></li>
      <li><a href="https://github.com/OSGeo/gdal/issues/"><span>Issue&#160;Tracker</span></a></li>
    </ul>
  </div>
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">GDAL Warp API Tutorial </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h1><a class="anchor" id="warptut_overview"></a>
Overview</h1>
<p>The GDAL Warp API (declared in <a class="el" href="gdalwarper_8h.html" title="GDAL warper related entry points and definitions. ">gdalwarper.h</a>) provides services for high performance image warping using application provided geometric transformation functions (GDALTransformerFunc), a variety of resampling kernels, and various masking options. Files much larger than can be held in memory can be warped.</p>
<p>This tutorial demonstrates how to implement an application using the Warp API. It assumes implementation in C++ as C and Python bindings are incomplete for the Warp API. It also assumes familiarity with the <a href="gdal_datamodel.html">GDAL Data Model</a>, and the general GDAL API.</p>
<p>Applications normally perform a warp by initializing a <a class="el" href="structGDALWarpOptions.html" title="Warp control options for use with GDALWarpOperation::Initialize() ">GDALWarpOptions</a> structure with the options to be utilized, instantiating a <a class="el" href="classGDALWarpOperation.html" title="High level image warping class. ">GDALWarpOperation</a> based on these options, and then invoking the <a class="el" href="classGDALWarpOperation.html#a589a9b74fa370cc9eaf11bdfd9aab2ae" title="This method does a complete warp of the source image to the destination image for the indicated regio...">GDALWarpOperation::ChunkAndWarpImage()</a> method to perform the warp options internally using the <a class="el" href="classGDALWarpKernel.html" title="This class represents the lowest level of abstraction of warping. ">GDALWarpKernel</a> class.</p>
<h1><a class="anchor" id="warptut_simple"></a>
A Simple Reprojection Case</h1>
<p>First we will construct a relatively simple example for reprojecting an image, assuming an appropriate output file already exists, and with minimal error checking.</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &quot;<a class="code" href="gdalwarper_8h.html">gdalwarper.h</a>&quot;</span></div>
<div class="line"></div>
<div class="line"><span class="keywordtype">int</span> main()</div>
<div class="line">{</div>
<div class="line">    <a class="code" href="gdal_8h.html#a2316f0c00f9997839f782ec946f8303d">GDALDatasetH</a>  hSrcDS, hDstDS;</div>
<div class="line"></div>
<div class="line">    <span class="comment">// Open input and output files.</span></div>
<div class="line"></div>
<div class="line">    <a class="code" href="gdal_8h.html#a9d40bc998bd6ed07ccde96028e85ae26">GDALAllRegister</a>();</div>
<div class="line"></div>
<div class="line">    hSrcDS = <a class="code" href="gdal_8h.html#a6836f0f810396c5e45622c8ef94624d4">GDALOpen</a>( <span class="stringliteral">&quot;in.tif&quot;</span>, <a class="code" href="gdal_8h.html#a045e3967c208993f70257bfd40c9f1d7a5a021a550b9d5640307d3c0e7e35b732">GA_ReadOnly</a> );</div>
<div class="line">    hDstDS = <a class="code" href="gdal_8h.html#a6836f0f810396c5e45622c8ef94624d4">GDALOpen</a>( <span class="stringliteral">&quot;out.tif&quot;</span>, <a class="code" href="gdal_8h.html#a045e3967c208993f70257bfd40c9f1d7a61c6081de474ef2a756982d3c53130a2">GA_Update</a> );</div>
<div class="line"></div>
<div class="line">    <span class="comment">// Setup warp options.</span></div>
<div class="line"></div>
<div class="line">    <a class="code" href="structGDALWarpOptions.html">GDALWarpOptions</a> *psWarpOptions = <a class="code" href="gdalwarper_8h.html#ae069a75e4ced6e9abab61f7e94d09440">GDALCreateWarpOptions</a>();</div>
<div class="line"></div>
<div class="line">    psWarpOptions-&gt;<a class="code" href="structGDALWarpOptions.html#a65f68e1cf7ca641c5d0a93762d0416d5">hSrcDS</a> = hSrcDS;</div>
<div class="line">    psWarpOptions-&gt;<a class="code" href="structGDALWarpOptions.html#a0550f97dd229ae14e7356588a9c74ffb">hDstDS</a> = hDstDS;</div>
<div class="line"></div>
<div class="line">    psWarpOptions-&gt;<a class="code" href="structGDALWarpOptions.html#a9b60196e623b269e8f4905bf9e1792e2">nBandCount</a> = 1;</div>
<div class="line">    psWarpOptions-&gt;<a class="code" href="structGDALWarpOptions.html#a841df78e52087580fa6c0bd811714160">panSrcBands</a> =</div>
<div class="line">        (<span class="keywordtype">int</span> *) <a class="code" href="cpl__conv_8h.html#a9a806de98fbddb1337efdb18651aa0f7">CPLMalloc</a>(<span class="keyword">sizeof</span>(<span class="keywordtype">int</span>) * psWarpOptions-&gt;<a class="code" href="structGDALWarpOptions.html#a9b60196e623b269e8f4905bf9e1792e2">nBandCount</a> );</div>
<div class="line">    psWarpOptions-&gt;<a class="code" href="structGDALWarpOptions.html#a841df78e52087580fa6c0bd811714160">panSrcBands</a>[0] = 1;</div>
<div class="line">    psWarpOptions-&gt;<a class="code" href="structGDALWarpOptions.html#a4997d9eff29876052adb47f7928497f7">panDstBands</a> =</div>
<div class="line">        (<span class="keywordtype">int</span> *) <a class="code" href="cpl__conv_8h.html#a9a806de98fbddb1337efdb18651aa0f7">CPLMalloc</a>(<span class="keyword">sizeof</span>(<span class="keywordtype">int</span>) * psWarpOptions-&gt;<a class="code" href="structGDALWarpOptions.html#a9b60196e623b269e8f4905bf9e1792e2">nBandCount</a> );</div>
<div class="line">    psWarpOptions-&gt;<a class="code" href="structGDALWarpOptions.html#a4997d9eff29876052adb47f7928497f7">panDstBands</a>[0] = 1;</div>
<div class="line"></div>
<div class="line">    psWarpOptions-&gt;<a class="code" href="structGDALWarpOptions.html#a5cf9b6e00e148b360f659c4e2ac68c01">pfnProgress</a> = GDALTermProgress;</div>
<div class="line"></div>
<div class="line">    <span class="comment">// Establish reprojection transformer.</span></div>
<div class="line"></div>
<div class="line">    psWarpOptions-&gt;<a class="code" href="structGDALWarpOptions.html#a35647845a2629da876f379f82d58a2cd">pTransformerArg</a> =</div>
<div class="line">        <a class="code" href="gdal__alg_8h.html#a7671696d085085a0bfba3c3df9ffcc0a">GDALCreateGenImgProjTransformer</a>( hSrcDS,</div>
<div class="line">                                         <a class="code" href="gdal_8h.html#a639a11014cf6c4ff30df6f21d5db9da2">GDALGetProjectionRef</a>(hSrcDS),</div>
<div class="line">                                         hDstDS,</div>
<div class="line">                                         <a class="code" href="gdal_8h.html#a639a11014cf6c4ff30df6f21d5db9da2">GDALGetProjectionRef</a>(hDstDS),</div>
<div class="line">                                         FALSE, 0.0, 1 );</div>
<div class="line">    psWarpOptions-&gt;<a class="code" href="structGDALWarpOptions.html#a8899bacf99abdfd14c8bd590bd6079fa">pfnTransformer</a> = <a class="code" href="gdal__alg_8h.html#a109c26234c2f934164e29649353532b6">GDALGenImgProjTransform</a>;</div>
<div class="line"></div>
<div class="line">    <span class="comment">// Initialize and execute the warp operation.</span></div>
<div class="line"></div>
<div class="line">    <a class="code" href="classGDALWarpOperation.html">GDALWarpOperation</a> oOperation;</div>
<div class="line"></div>
<div class="line">    oOperation.<a class="code" href="classGDALWarpOperation.html#a52447611e7e196187a4667842f628d3b">Initialize</a>( psWarpOptions );</div>
<div class="line">    oOperation.<a class="code" href="classGDALWarpOperation.html#a589a9b74fa370cc9eaf11bdfd9aab2ae">ChunkAndWarpImage</a>( 0, 0,</div>
<div class="line">                                  <a class="code" href="gdal_8h.html#a4ef08b38a70b6e04f25a81bd82ef0138">GDALGetRasterXSize</a>( hDstDS ),</div>
<div class="line">                                  <a class="code" href="gdal_8h.html#ae0c0af31441c6bac994f35ac26c82f99">GDALGetRasterYSize</a>( hDstDS ) );</div>
<div class="line"></div>
<div class="line">    <a class="code" href="gdal__alg_8h.html#a5fb383c4e5197e8e37ae1265cca8124d">GDALDestroyGenImgProjTransformer</a>( psWarpOptions-&gt;<a class="code" href="structGDALWarpOptions.html#a35647845a2629da876f379f82d58a2cd">pTransformerArg</a> );</div>
<div class="line">    <a class="code" href="gdalwarper_8h.html#a6267be57edda05a9206d519e1a20897c">GDALDestroyWarpOptions</a>( psWarpOptions );</div>
<div class="line"></div>
<div class="line">    <a class="code" href="gdal_8h.html#a0984222d45a72028fcbbf1f44831ffbc">GDALClose</a>( hDstDS );</div>
<div class="line">    <a class="code" href="gdal_8h.html#a0984222d45a72028fcbbf1f44831ffbc">GDALClose</a>( hSrcDS );</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">return</span> 0;</div>
<div class="line">}</div>
</div><!-- fragment --><p>This example opens the existing input and output files (in.tif and out.tif). A <a class="el" href="structGDALWarpOptions.html" title="Warp control options for use with GDALWarpOperation::Initialize() ">GDALWarpOptions</a> structure is allocated (<a class="el" href="gdalwarper_8h.html#ae069a75e4ced6e9abab61f7e94d09440" title="Create a warp options structure. ">GDALCreateWarpOptions()</a> sets lots of sensible defaults for stuff, always use it for defaulting things), and the input and output file handles, and band lists are set. The panSrcBands and panDstBands lists are dynamically allocated here and will be free automatically by <a class="el" href="gdalwarper_8h.html#a6267be57edda05a9206d519e1a20897c" title="Destroy a warp options structure. ">GDALDestroyWarpOptions()</a>. The simple terminal output progress monitor (GDALTermProgress) is installed for reporting completion progress to the user.</p>
<p><a class="el" href="gdal__alg_8h.html#a7671696d085085a0bfba3c3df9ffcc0a" title="Create image to image transformer. ">GDALCreateGenImgProjTransformer()</a> is used to initialize the reprojection transformation between the source and destination images. We assume that they already have reasonable bounds and coordinate systems set. Use of GCPs is disabled.</p>
<p>Once the options structure is ready, a <a class="el" href="classGDALWarpOperation.html" title="High level image warping class. ">GDALWarpOperation</a> is instantiated using them, and the warp actually performed with <a class="el" href="classGDALWarpOperation.html#a589a9b74fa370cc9eaf11bdfd9aab2ae" title="This method does a complete warp of the source image to the destination image for the indicated regio...">GDALWarpOperation::ChunkAndWarpImage()</a>. Then the transformer, warp options and datasets are cleaned up.</p>
<p>Normally error check would be needed after opening files, setting up the reprojection transformer (returns NULL on failure), and initializing the warp.</p>
<h1><a class="anchor" id="warptut_options"></a>
Other Warping Options</h1>
<p>The <a class="el" href="structGDALWarpOptions.html" title="Warp control options for use with GDALWarpOperation::Initialize() ">GDALWarpOptions</a> structures contains a number of items that can be set to control warping behavior. A few of particular interest are:</p>
<ol>
<li>
<p class="startli"><a class="el" href="structGDALWarpOptions.html#aa72d8bd37f896272cd979ce9dc9d65e9">GDALWarpOptions::dfWarpMemoryLimit</a> - Set the maximum amount of memory to be used by the <a class="el" href="classGDALWarpOperation.html" title="High level image warping class. ">GDALWarpOperation</a> when selecting a size of image chunk to operate on. The value is in bytes, and the default is likely to be conservative (small). Increasing the chunk size can help substantially in some situations but care should be taken to ensure that this size, plus the GDAL cache size plus the working set of GDAL, your application and the operating system are less than the size of RAM or else excessive swapping is likely to interfere with performance. On a system with 256MB of RAM, a value of at least 64MB (roughly 64000000 bytes) is reasonable. Note that this value does <b>not</b> include the memory used by GDAL for low level block caching.</p>
<p class="endli"></p>
</li>
<li>
<p class="startli">GDALWarpOpations::eResampleAlg - One of GRA_NearestNeighbour (the default, and fastest), GRA_Bilinear (2x2 bilinear resampling) or GRA_Cubic. The GRA_NearestNeighbour type should generally be used for thematic or color mapped images. The other resampling types may give better results for thematic images, especially when substantially changing resolution.</p>
<p class="endli"></p>
</li>
<li>
<p class="startli"><a class="el" href="structGDALWarpOptions.html#a304bf40101dbea72b77067071919eb21">GDALWarpOptions::padfSrcNoDataReal</a> - This array (one entry per band being processed) may be setup with a "nodata" value for each band if you wish to avoid having pixels of some background value copied to the destination image.</p>
<p class="endli"></p>
</li>
<li>
<p class="startli"><a class="anchor" id="#warpoptions"></a> <a class="el" href="structGDALWarpOptions.html#a0ed77f9917bb96c7a9aabd73d4d06e08" title="A string list of additional options controlling the warp operation in name=value format. ">GDALWarpOptions::papszWarpOptions</a> - This is a string list of NAME=VALUE options passed to the warper. See the <a class="el" href="structGDALWarpOptions.html#a0ed77f9917bb96c7a9aabd73d4d06e08" title="A string list of additional options controlling the warp operation in name=value format. ">GDALWarpOptions::papszWarpOptions</a> docs for all options. Supported values include:</p>
<ul>
<li>
<p class="startli">INIT_DEST=[value] or INIT_DEST=NO_DATA: This option forces the destination image to be initialized to the indicated value (for all bands) or indicates that it should be initialized to the NO_DATA value in padfDstNoDataReal/padfDstNoDataImag. If this value isn't set the destination image will be read and the source warp overlaid on it.</p>
<p class="endli"></p>
</li>
<li>
WRITE_FLUSH=YES/NO: This option forces a flush to disk of data after each chunk is processed. In some cases this helps ensure a serial writing of the output data otherwise a block of data may be written to disk each time a block of data is read for the input buffer resulting in a lot of extra seeking around the disk, and reduced IO throughput. The default at this time is NO. </li>
</ul>
<p class="endli"></p>
</li>
</ol>
<h1><a class="anchor" id="warptut_output"></a>
Creating the Output File</h1>
<p>In the previous case an appropriate output file was already assumed to exist. Now we will go through a case where a new file with appropriate bounds in a new coordinate system is created. This operation doesn't relate specifically to the warp API. It is just using the transformation API.</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &quot;<a class="code" href="gdalwarper_8h.html">gdalwarper.h</a>&quot;</span></div>
<div class="line"><span class="preprocessor">#include &quot;<a class="code" href="ogr__spatialref_8h.html">ogr_spatialref.h</a>&quot;</span></div>
<div class="line"></div>
<div class="line">...</div>
<div class="line"></div>
<div class="line">    <a class="code" href="gdal_8h.html#adfd09c07260442427a225e2a536ead72">GDALDriverH</a> hDriver;</div>
<div class="line">    <a class="code" href="gdal_8h.html#a22e22ce0a55036a96f652765793fb7a4">GDALDataType</a> eDT;</div>
<div class="line">    <a class="code" href="gdal_8h.html#a2316f0c00f9997839f782ec946f8303d">GDALDatasetH</a> hDstDS;</div>
<div class="line">    <a class="code" href="gdal_8h.html#a2316f0c00f9997839f782ec946f8303d">GDALDatasetH</a> hSrcDS;</div>
<div class="line"></div>
<div class="line">    <span class="comment">// Open the source file.</span></div>
<div class="line"></div>
<div class="line">    hSrcDS = <a class="code" href="gdal_8h.html#a6836f0f810396c5e45622c8ef94624d4">GDALOpen</a>( <span class="stringliteral">&quot;in.tif&quot;</span>, <a class="code" href="gdal_8h.html#a045e3967c208993f70257bfd40c9f1d7a5a021a550b9d5640307d3c0e7e35b732">GA_ReadOnly</a> );</div>
<div class="line">    <a class="code" href="cpl__error_8h.html#a40ae27078f2a969a445daa022405cf72">CPLAssert</a>( hSrcDS != NULL );</div>
<div class="line"></div>
<div class="line">    <span class="comment">// Create output with same datatype as first input band.</span></div>
<div class="line"></div>
<div class="line">    eDT = <a class="code" href="gdal_8h.html#a2edba2a096915aa63e7ca0bf4c383bd0">GDALGetRasterDataType</a>(<a class="code" href="gdal_8h.html#a2a74e5e34528589303c1521ebfb9c162">GDALGetRasterBand</a>(hSrcDS,1));</div>
<div class="line"></div>
<div class="line">    <span class="comment">// Get output driver (GeoTIFF format)</span></div>
<div class="line"></div>
<div class="line">    hDriver = <a class="code" href="gdal_8h.html#ae8ae868eef1e4773283d137b0a1adfc4">GDALGetDriverByName</a>( <span class="stringliteral">&quot;GTiff&quot;</span> );</div>
<div class="line">    <a class="code" href="cpl__error_8h.html#a40ae27078f2a969a445daa022405cf72">CPLAssert</a>( hDriver != NULL );</div>
<div class="line"></div>
<div class="line">    <span class="comment">// Get Source coordinate system.</span></div>
<div class="line"></div>
<div class="line">    <span class="keyword">const</span> <span class="keywordtype">char</span> *pszSrcWKT, *pszDstWKT = NULL;</div>
<div class="line"></div>
<div class="line">    pszSrcWKT = <a class="code" href="gdal_8h.html#a639a11014cf6c4ff30df6f21d5db9da2">GDALGetProjectionRef</a>( hSrcDS );</div>
<div class="line">    <a class="code" href="cpl__error_8h.html#a40ae27078f2a969a445daa022405cf72">CPLAssert</a>( pszSrcWKT != NULL &amp;&amp; strlen(pszSrcWKT) &gt; 0 );</div>
<div class="line"></div>
<div class="line">    <span class="comment">// Setup output coordinate system that is UTM 11 WGS84.</span></div>
<div class="line"></div>
<div class="line">    <a class="code" href="classOGRSpatialReference.html">OGRSpatialReference</a> oSRS;</div>
<div class="line"></div>
<div class="line">    oSRS.<a class="code" href="classOGRSpatialReference.html#a0c4f6fcab663c9eb6d465787cad3833c">SetUTM</a>( 11, TRUE );</div>
<div class="line">    oSRS.<a class="code" href="classOGRSpatialReference.html#a096b8dde4fd2eb475acd376060940b02">SetWellKnownGeogCS</a>( <span class="stringliteral">&quot;WGS84&quot;</span> );</div>
<div class="line"></div>
<div class="line">    oSRS.<a class="code" href="classOGRSpatialReference.html#a596b8e527d66a5054408159f0006fdac">exportToWkt</a>( &amp;pszDstWKT );</div>
<div class="line"></div>
<div class="line">    <span class="comment">// Create a transformer that maps from source pixel/line coordinates</span></div>
<div class="line">    <span class="comment">// to destination georeferenced coordinates (not destination</span></div>
<div class="line">    <span class="comment">// pixel line).  We do that by omitting the destination dataset</span></div>
<div class="line">    <span class="comment">// handle (setting it to NULL).</span></div>
<div class="line"></div>
<div class="line">    <span class="keywordtype">void</span> *hTransformArg;</div>
<div class="line"></div>
<div class="line">    hTransformArg =</div>
<div class="line">        <a class="code" href="gdal__alg_8h.html#a7671696d085085a0bfba3c3df9ffcc0a">GDALCreateGenImgProjTransformer</a>( hSrcDS, pszSrcWKT, NULL, pszDstWKT,</div>
<div class="line">                                         FALSE, 0, 1 );</div>
<div class="line">    <a class="code" href="cpl__error_8h.html#a40ae27078f2a969a445daa022405cf72">CPLAssert</a>( hTransformArg != NULL );</div>
<div class="line"></div>
<div class="line">    <span class="comment">// Get approximate output georeferenced bounds and resolution for file.</span></div>
<div class="line"></div>
<div class="line">    <span class="keywordtype">double</span> adfDstGeoTransform[6];</div>
<div class="line">    <span class="keywordtype">int</span> nPixels=0, nLines=0;</div>
<div class="line">    <a class="code" href="cpl__error_8h.html#a463ba7c7202a505416ff95b1aeefa2de">CPLErr</a> eErr;</div>
<div class="line"></div>
<div class="line">    eErr = <a class="code" href="gdal__alg_8h.html#a816819e7495bfce06dbd110f7c57af65">GDALSuggestedWarpOutput</a>( hSrcDS,</div>
<div class="line">                                    <a class="code" href="gdal__alg_8h.html#a109c26234c2f934164e29649353532b6">GDALGenImgProjTransform</a>, hTransformArg,</div>
<div class="line">                                    adfDstGeoTransform, &amp;nPixels, &amp;nLines );</div>
<div class="line">    <a class="code" href="cpl__error_8h.html#a40ae27078f2a969a445daa022405cf72">CPLAssert</a>( eErr == CE_None );</div>
<div class="line"></div>
<div class="line">    <a class="code" href="gdal__alg_8h.html#a5fb383c4e5197e8e37ae1265cca8124d">GDALDestroyGenImgProjTransformer</a>( hTransformArg );</div>
<div class="line"></div>
<div class="line">    <span class="comment">// Create the output file.</span></div>
<div class="line"></div>
<div class="line">    hDstDS = <a class="code" href="gdal_8h.html#a791083781fefae0bb4b289c4b1b838e9">GDALCreate</a>( hDriver, <span class="stringliteral">&quot;out.tif&quot;</span>, nPixels, nLines,</div>
<div class="line">                         <a class="code" href="gdal_8h.html#a1b9f888aac1cb4dbc99dc1dc023174b7">GDALGetRasterCount</a>(hSrcDS), eDT, NULL );</div>
<div class="line"></div>
<div class="line">    <a class="code" href="cpl__error_8h.html#a40ae27078f2a969a445daa022405cf72">CPLAssert</a>( hDstDS != NULL );</div>
<div class="line"></div>
<div class="line">    <span class="comment">// Write out the projection definition.</span></div>
<div class="line"></div>
<div class="line">    <a class="code" href="gdal_8h.html#a145f2be5db1ac31a07a9d4389f4ace65">GDALSetProjection</a>( hDstDS, pszDstWKT );</div>
<div class="line">    <a class="code" href="gdal_8h.html#ae93448112c1a7e69f2764c1aa3c6c8b5">GDALSetGeoTransform</a>( hDstDS, adfDstGeoTransform );</div>
<div class="line"></div>
<div class="line">    <span class="comment">// Copy the color table, if required.</span></div>
<div class="line"></div>
<div class="line">    <a class="code" href="gdal_8h.html#af1baae80dd0ec873ad7ad5b28dda44f3">GDALColorTableH</a> hCT;</div>
<div class="line"></div>
<div class="line">    hCT = <a class="code" href="gdal_8h.html#ab4ebf9ba142ed1847cfb04143fb75c3e">GDALGetRasterColorTable</a>( <a class="code" href="gdal_8h.html#a2a74e5e34528589303c1521ebfb9c162">GDALGetRasterBand</a>(hSrcDS,1) );</div>
<div class="line">    <span class="keywordflow">if</span>( hCT != NULL )</div>
<div class="line">        <a class="code" href="gdal_8h.html#ade5abc76e229097e6799ab58414aeaed">GDALSetRasterColorTable</a>( <a class="code" href="gdal_8h.html#a2a74e5e34528589303c1521ebfb9c162">GDALGetRasterBand</a>(hDstDS,1), hCT );</div>
<div class="line"></div>
<div class="line">    ... proceed with warp as before ...</div>
</div><!-- fragment --><p>Some notes on this logic:</p>
<ul>
<li>
<p class="startli">We need to create the transformer to output coordinates such that the output of the transformer is georeferenced, not pixel line coordinates since we use the transformer to map pixels around the source image into destination georeferenced coordinates.</p>
<p class="endli"></p>
</li>
<li>
<p class="startli">The <a class="el" href="gdal__alg_8h.html#a816819e7495bfce06dbd110f7c57af65" title="Suggest output file size. ">GDALSuggestedWarpOutput()</a> function will return an adfDstGeoTransform, nPixels and nLines that describes an output image size and georeferenced extents that should hold all pixels from the source image. The resolution is intended to be comparable to the source, but the output pixels are always square regardless of the shape of input pixels.</p>
<p class="endli"></p>
</li>
<li>
<p class="startli">The warper requires an output file in a format that can be "randomly" written to. This generally limits things to uncompressed formats that have an implementation of the Create() method (as opposed to CreateCopy()). To warp to compressed formats, or CreateCopy() style formats it is necessary to produce a full temporary copy of the image in a better behaved format, and then CreateCopy() it to the desired final format.</p>
<p class="endli"></p>
</li>
<li>
<p class="startli">The Warp API copies only pixels. All color maps, georeferencing and other metadata must be copied to the destination by the application.</p>
<p class="endli"></p>
</li>
</ul>
<h1><a class="anchor" id="warptut_performance"></a>
Performance Optimization</h1>
<p>There are a number of things that can be done to optimize the performance of the warp API.</p>
<ol>
<li>
<p class="startli">Increase the amount of memory available for the Warp API chunking so that larger chunks can be operated on at a time. This is the <a class="el" href="structGDALWarpOptions.html#aa72d8bd37f896272cd979ce9dc9d65e9">GDALWarpOptions::dfWarpMemoryLimit</a> parameter. In theory the larger the chunk size operated on the more efficient the I/O strategy, and the more efficient the approximated transformation will be. However, the sum of the warp memory and the GDAL cache should be less than RAM size, likely around 2/3 of RAM size.</p>
<p class="endli"></p>
</li>
<li>
<p class="startli">Increase the amount of memory for GDAL caching. This is especially important when working with very large input and output images that are scanline oriented. If all the input or output scanlines have to be re-read for each chunk they intersect performance may degrade greatly. Use <a class="el" href="gdal_8h.html#adfb1e95703ee577f012935869852d96c" title="Set maximum cache memory. ">GDALSetCacheMax()</a> to control the amount of memory available for caching within GDAL.</p>
<p class="endli"></p>
</li>
<li>
<p class="startli">Use an approximated transformation instead of exact reprojection for each pixel to be transformed. This code illustrates how an approximated transformation could be created based on a reprojection transformation, but with a given error threshold (dfErrorThreshold in output pixels).</p>
<div class="fragment"><div class="line">hTransformArg =</div>
<div class="line">    <a class="code" href="gdal__alg_8h.html#a4ec403b75384f0a71130eb009078426f">GDALCreateApproxTransformer</a>( <a class="code" href="gdal__alg_8h.html#a109c26234c2f934164e29649353532b6">GDALGenImgProjTransform</a>,</div>
<div class="line">                                 hGenImgProjArg, dfErrorThreshold );</div>
<div class="line">pfnTransformer = <a class="code" href="gdal__alg_8h.html#a766ccb23b021d30d86908c08ad8d1668">GDALApproxTransform</a>;</div>
</div><!-- fragment --><p class="endli"></p>
</li>
<li>
<p class="startli">When writing to a blank output file, use the INIT_DEST option in the <a class="el" href="structGDALWarpOptions.html#a0ed77f9917bb96c7a9aabd73d4d06e08" title="A string list of additional options controlling the warp operation in name=value format. ">GDALWarpOptions::papszWarpOptions</a> to cause the output chunks to be initialized to a fixed value, instead of being read from the output. This can substantially reduce unnecessary IO work.</p>
<p class="endli"></p>
</li>
<li>
<p class="startli">Use tiled input and output formats. Tiled formats allow a given chunk of source and destination imagery to be accessed without having to touch a great deal of extra image data. Large scanline oriented files can result in a great deal of wasted extra IO.</p>
<p class="endli"></p>
</li>
<li>
<p class="startli">Process all bands in one call. This ensures the transformation calculations don't have to be performed for each band.</p>
<p class="endli"></p>
</li>
<li>
<p class="startli">Use the <a class="el" href="classGDALWarpOperation.html#aa4fcccc201832f6f692fd290848cf4f1" title="This method does a complete warp of the source image to the destination image for the indicated regio...">GDALWarpOperation::ChunkAndWarpMulti()</a> method instead of <a class="el" href="classGDALWarpOperation.html#a589a9b74fa370cc9eaf11bdfd9aab2ae" title="This method does a complete warp of the source image to the destination image for the indicated regio...">GDALWarpOperation::ChunkAndWarpImage()</a>. It uses a separate thread for the IO and the actual image warp operation allowing more effective use of CPU and IO bandwidth. For this to work GDAL needs to have been built with multi-threading support (default on Win32, default on Unix since GDAL 1.8.0, for previous versions &ndash;with-threads was required in configure).</p>
<p class="endli"></p>
</li>
<li>
<p class="startli">The resampling kernels vary is work required from nearest neighbour being least, then bilinear then cubic. Don't use a more complex resampling kernel than needed.</p>
<p class="endli"></p>
</li>
<li>
<p class="startli">Avoid use of esoteric masking options so that special simplified logic case be used for common special cases. For instance, nearest neighbour resampling with no masking on 8bit data is highly optimized compared to the general case.</p>
<p class="endli"></p>
</li>
</ol>
<h1><a class="anchor" id="warptut_other_opts"></a>
Other Masking Options</h1>
<p>The <a class="el" href="structGDALWarpOptions.html" title="Warp control options for use with GDALWarpOperation::Initialize() ">GDALWarpOptions</a> include a bunch of esoteric masking capabilities, for validity masks, and density masks on input and output. Some of these are not yet implemented and others are implemented but poorly tested. Other than per-band validity masks it is advised that these features be used with caution at this time.</p>
<p> 
<p>
$Id$
</p>
 </p>
</div></div><!-- contents -->
<hr>
Generated for GDAL by
<a href="http://www.doxygen.org/index.html"><img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.8.8.
</body>
</html>
