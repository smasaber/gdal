<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.8"/>
<title>GDAL: GNM Tutorial</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">GDAL
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.8 -->
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li class="current"><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li><a href="usergroup0.html"><span>Download</span></a></li>
      <li><a href="https://github.com/OSGeo/gdal/issues/"><span>Issue&#160;Tracker</span></a></li>
    </ul>
  </div>
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">GNM Tutorial </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>This document is intended to describe using the GNM C++ classes to work with networks. It is advised to read the <a href="gnm_arch.html">GNM architecture</a> before to understand the purpose and structure of GNM classes.</p>
<h1><a class="anchor" id="gnm_tut_manage"></a>
Managing networks</h1>
<p>In the first example we will create a small water network on the base of the set of spatial data (two shapefiles: pipes and wells which are situated at the GDAL source tree: autotest\gnm\data). The use of the common network format - GNMGdalNetwork class - will allow us to select one of the GDAL-supported vector formats for our network - ESRI Shapefile. After the creation we will build a topology and add some additional data: pumps layer, in order to manually edit network topology.</p>
<p>Initially we register GDAL drivers and create some options (string pairs), which will be passed as parameters during network creation. Here we create a network's name.</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &quot;gnm.h&quot;</span></div>
<div class="line"><span class="preprocessor">#include &lt;vector&gt;</span></div>
<div class="line"></div>
<div class="line"><span class="keywordtype">int</span> main ()</div>
<div class="line">{</div>
<div class="line">    <a class="code" href="gdal_8h.html#a9d40bc998bd6ed07ccde96028e85ae26">GDALAllRegister</a>();</div>
<div class="line"></div>
<div class="line">    <span class="keywordtype">char</span> **papszDSCO = NULL;</div>
<div class="line">    papszDSCO = <a class="code" href="cpl__string_8h.html#a140315b0903d52c438c143894f0d9847">CSLAddNameValue</a>(papszDSCO, GNM_MD_NAME, <span class="stringliteral">&quot;my_pipes_network&quot;</span>);</div>
<div class="line">    papszDSCO = <a class="code" href="cpl__string_8h.html#a140315b0903d52c438c143894f0d9847">CSLAddNameValue</a>(papszDSCO, GNM_MD_SRS, <span class="stringliteral">&quot;EPSG:4326&quot;</span>);</div>
<div class="line">    papszDSCO = <a class="code" href="cpl__string_8h.html#a140315b0903d52c438c143894f0d9847">CSLAddNameValue</a>(papszDSCO, GNM_MD_DESCR, <span class="stringliteral">&quot;My pipes network&quot;</span>);</div>
<div class="line">    papszDSCO = <a class="code" href="cpl__string_8h.html#a140315b0903d52c438c143894f0d9847">CSLAddNameValue</a>(papszDSCO, GNM_MD_FORMAT, <span class="stringliteral">&quot;ESRI Shapefile&quot;</span>);</div>
</div><!-- fragment --><p>Some options are obligatory. The following parameters must be specified during the network creation: the path/name; format of network storage; spatial reference system (EPSG, WKT, etc.). The according dataset with the "network part" will be created and the resulting network will be returned.</p>
<div class="fragment"><div class="line"><a class="code" href="classGDALDriver.html">GDALDriver</a> *poDriver = <a class="code" href="gdal__priv_8h.html#a4fb74d15f12b1ecd77bd8e5c48086590">GetGDALDriverManager</a>()-&gt;<a class="code" href="classGDALDriverManager.html#ac26308c182440c8abd584040fa89bd4f">GetDriverByName</a>(<span class="stringliteral">&quot;GNMFile&quot;</span>);</div>
<div class="line"><a class="code" href="classGNMGenericNetwork.html">GNMGenericNetwork</a>* poDS = (<a class="code" href="classGNMGenericNetwork.html">GNMGenericNetwork</a>*) poDriver-&gt;<a class="code" href="classGDALDriver.html#adb7bff9007fa5190d6cf742cf76942a8">Create</a>( <span class="stringliteral">&quot;..\\network_data&quot;</span>, 0, 0, 0, <a class="code" href="gdal_8h.html#a22e22ce0a55036a96f652765793fb7a4aee80d7a2ef95f128685e66f6e1024cbe">GDT_Unknown</a>,</div>
<div class="line">                                                   papszDSCO );</div>
<div class="line"><a class="code" href="cpl__string_8h.html#a5a39b9c5896a273cc6f06c1d5be93238">CSLDestroy</a>(papszDSCO);</div>
</div><!-- fragment --><p>For now we have a void network consisted of only "system layers". We need to populate it with "class layers" full of features, so we open a certain foreign dataset and copy layers from it to our network. Note, that we use <a class="el" href="classGDALDataset.html" title="A set of associated raster bands, usually from one file. ">GDALDataset</a>:: methods for working with "class layers", because <a class="el" href="classGNMNetwork.html" title="General GNM class which represents a geography network of common format. ">GNMNetwork</a> inherited from <a class="el" href="classGDALDataset.html" title="A set of associated raster bands, usually from one file. ">GDALDataset</a>.</p>
<div class="fragment"><div class="line"><a class="code" href="classGDALDataset.html">GDALDataset</a> *poSrcDS = (<a class="code" href="classGDALDataset.html">GDALDataset</a>*) <a class="code" href="gdal_8h.html#aca05455472359964151f9c891d678d5e">GDALOpenEx</a>(<span class="stringliteral">&quot;..\\in_data&quot;</span>,</div>
<div class="line">                                <a class="code" href="gdal_8h.html#a8253249767721c3e54a4a2844b30f256">GDAL_OF_VECTOR</a> | <a class="code" href="gdal_8h.html#a6a137b58124afec0b1e8d3b7d1bf4cc8">GDAL_OF_READONLY</a>, NULL, NULL, NULL );</div>
<div class="line"></div>
<div class="line"><a class="code" href="classOGRLayer.html">OGRLayer</a> *poSrcLayer1 = poSrcDS-&gt;<a class="code" href="classGDALDataset.html#a576978fecfad68741b44719605cf637e">GetLayerByName</a>(<span class="stringliteral">&quot;pipes&quot;</span>);</div>
<div class="line"><a class="code" href="classOGRLayer.html">OGRLayer</a> *poSrcLayer2 = poSrcDS-&gt;<a class="code" href="classGDALDataset.html#a576978fecfad68741b44719605cf637e">GetLayerByName</a>(<span class="stringliteral">&quot;wells&quot;</span>);</div>
<div class="line"></div>
<div class="line">poDS-&gt;<a class="code" href="classGNMGenericNetwork.html#a778b7bf19164768f3f198653c15f6d6c">CopyLayer</a>(poSrcLayer1, <span class="stringliteral">&quot;pipes&quot;</span>);</div>
<div class="line">poDS-&gt;<a class="code" href="classGNMGenericNetwork.html#a778b7bf19164768f3f198653c15f6d6c">CopyLayer</a>(poSrcLayer2, <span class="stringliteral">&quot;wells&quot;</span>);</div>
<div class="line"></div>
<div class="line"><a class="code" href="gdal_8h.html#a0984222d45a72028fcbbf1f44831ffbc">GDALClose</a>(poSrcDS);</div>
</div><!-- fragment --><p>After the successful copying we have the network full of features, but with no topology. The features were added and registered in the network but they are still not connected with each other. Now it is time to build the network topology. There are two ways of doing this in GNM: manually or automatically. In the most cases automatic building is more convenient, while manual is useful for small editings. Automatic building requires some parameters: we must specify which "class layers" will participate in topology building (we select our two layers), a snap tolerance, direct and inverse cost, direction, which is equal 0.00005 in our case. If the building will be successful the network's graph will be filled with the according connections.</p>
<div class="fragment"><div class="line">printf(<span class="stringliteral">&quot;\nBuilding network topology ...\n&quot;</span>);</div>
<div class="line"><span class="keywordtype">char</span> **papszLayers = NULL;</div>
<div class="line"><span class="keywordflow">for</span>(<span class="keywordtype">int</span> i = 0; i &lt; poDS-&gt;<a class="code" href="classGNMGenericNetwork.html#a60be29b9b6a343bc33fbb160ea4faedd">GetLayerCount</a>(); ++i)</div>
<div class="line">{</div>
<div class="line">    <a class="code" href="classOGRLayer.html">OGRLayer</a>* poLayer = poDS-&gt;<a class="code" href="classGNMGenericNetwork.html#a5c7fad64871d7d57f579e3865ffd5dc1">GetLayer</a>(i);</div>
<div class="line">    papszLayers = <a class="code" href="cpl__string_8h.html#ae84fb70e547d924b925556b2105714d5">CSLAddString</a>(papszLayers, poLayer-&gt;<a class="code" href="classOGRLayer.html#a287f5ec7728cacc2f7d94882a9f1a22e">GetName</a>() );</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="keywordflow">if</span>(poGenericNetwork-&gt;ConnectPointsByLines(papszLayers, dfTolerance,</div>
<div class="line">                                    dfDirCost, dfInvCost, eDir) != CE_None )</div>
<div class="line">{</div>
<div class="line">    printf(<span class="stringliteral">&quot;Building topology failed\n&quot;</span>);</div>
<div class="line">}</div>
<div class="line"><span class="keywordflow">else</span></div>
<div class="line">{</div>
<div class="line">    printf(<span class="stringliteral">&quot;Topology has been built successfully\n&quot;</span>);</div>
<div class="line">}</div>
</div><!-- fragment --><p>At this point we have a ready network with topological and spatial data, which can be used now for different purposes (analysis, converting into different formats, etc). But sometimes it is necessary to modify some network's data. For example we need to add additional features and attach them to our built topology (modify topology). We create a new "class layer" in the network and add one feature to it.</p>
<div class="fragment"><div class="line"><a class="code" href="classOGRLayer.html">OGRLayer</a> *poNewLayer = poDS-&gt;<a class="code" href="classGDALDataset.html#afec5fd0fffddbdf530cd6294caa66a7d">CreateLayer</a>(<span class="stringliteral">&quot;pumps&quot;</span>, , NULL, <a class="code" href="ogr__core_8h.html#a800236a0d460ef66e687b7b65610f12aa6f8377c5a4a9d36ae2384f4a5f45d77f">wkbPoint</a>, NULL );</div>
<div class="line"><span class="keywordflow">if</span>( poNewLayer == NULL )</div>
<div class="line">{</div>
<div class="line">    printf( <span class="stringliteral">&quot;Layer creation failed.\n&quot;</span> );</div>
<div class="line">    exit( 1 );</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><a class="code" href="classOGRFieldDefn.html">OGRFieldDefn</a> fieldDefn (<span class="stringliteral">&quot;pressure&quot;</span>,<a class="code" href="ogr__core_8h.html#a787194bea637faf12d61643124a7c9fca99520e47d9e26303f7c0127c1254c962">OFTReal</a>);</div>
<div class="line"><span class="keywordflow">if</span>( poNewLayer-&gt;<a class="code" href="classOGRLayer.html#a00b1376a1eabb1298ef278f92f6d84be">CreateField</a>( &amp;fieldDefn ) != <a class="code" href="ogr__core_8h.html#a67a14d8dceb15392134cc51180c5e6f0">OGRERR_NONE</a> )</div>
<div class="line">{</div>
<div class="line">    printf( <span class="stringliteral">&quot;Creating Name field failed.\n&quot;</span> );</div>
<div class="line">    exit( 1 );</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><a class="code" href="classOGRFeature.html">OGRFeature</a> *poFeature = <a class="code" href="classOGRFeature.html#a0ef4455f24cfbec6cf37110f9116cf15">OGRFeature::CreateFeature</a>(poNewLayer-&gt;<a class="code" href="classOGRLayer.html#a80473bcfd11341e70dd35bebe94026cf">GetLayerDefn</a>());</div>
<div class="line"><a class="code" href="classOGRPoint.html">OGRPoint</a> pt;</div>
<div class="line">pt.<a class="code" href="classOGRPoint.html#a0eef5e2d9e0edeca0e0f06c7527facb4">setX</a>(37.291466);</div>
<div class="line">pt.setY(55.828351);</div>
<div class="line">poFeature-&gt;<a class="code" href="classOGRFeature.html#a67949569519c0de6ee3ea48f23ff11c9">SetGeometry</a>(&amp;pt);</div>
<div class="line"><span class="keywordflow">if</span>( poNewLayer-&gt;<a class="code" href="classOGRLayer.html#a5d6db0be3b8876142d54e8bfd5dc8324">CreateFeature</a>( poFeature ) != <a class="code" href="ogr__core_8h.html#a67a14d8dceb15392134cc51180c5e6f0">OGRERR_NONE</a> )</div>
<div class="line">{</div>
<div class="line">    printf( <span class="stringliteral">&quot;Failed to create feature.\n&quot;</span> );</div>
<div class="line">    exit( 1 );</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line">GNMGFID gfid = poFeature-&gt;<a class="code" href="classOGRFeature.html#a696f6e0c7f9a7025020b8ecf71cbd7a8">GetFID</a>();</div>
<div class="line"></div>
<div class="line"><a class="code" href="classOGRFeature.html#a5d2602d11f21567119da0ca6b6c5ad45">OGRFeature::DestroyFeature</a>( poFeature );</div>
</div><!-- fragment --><p>After the successful creation the feature will be registered in the network and we can connect it with others. There can be two possible ways to do this. In the first case we need a real feature which will be an edge in the connection, while in the second case we do not need such feature, and passing -1 into the ConnectFeatures() method means that the special system edge will be created for this connection and added to the graph automatically. In our case we had added only one point feature and we have not got the line one to be an edge, so we will use the "virtual" connection. We pass the GFID of our point as the source, the GFID of one of the existed features as the target and -1 as the connector. Note that we also set the costs (direct and inverse) and the direction of our edge manually and these values will be written to the graph. When we used the automatic connection (which also uses ConnectFeatures() internally) such vales were set automatically according to the rule which we also set before.</p>
<div class="fragment"><div class="line"><span class="keywordflow">if</span> (poDS-&gt;<a class="code" href="classGNMGenericNetwork.html#a75053c44125b84185f6390b7cb994f9e">ConnectFeatures</a>(gfid ,63, -1, 5.0, 5.0, GNMDirection_SrcToTgt) != GNMError_None)</div>
<div class="line">{</div>
<div class="line">    printf(<span class="stringliteral">&quot;Can not connect features\n&quot;</span>);</div>
<div class="line">}</div>
</div><!-- fragment --><p>After all we correctly close the network which frees the allocated resources.</p>
<div class="fragment"><div class="line"><a class="code" href="gdal_8h.html#a0984222d45a72028fcbbf1f44831ffbc">GDALClose</a>(poDS);</div>
</div><!-- fragment --><p>All in one block:</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &quot;gnm.h&quot;</span></div>
<div class="line"><span class="preprocessor">#include &quot;gnm_priv.h&quot;</span></div>
<div class="line"></div>
<div class="line"><span class="keywordtype">int</span> main ()</div>
<div class="line">{</div>
<div class="line">    <a class="code" href="gdal_8h.html#a9d40bc998bd6ed07ccde96028e85ae26">GDALAllRegister</a>();</div>
<div class="line"></div>
<div class="line">    <span class="keywordtype">char</span> **papszDSCO = NULL;</div>
<div class="line">    papszDSCO = <a class="code" href="cpl__string_8h.html#a140315b0903d52c438c143894f0d9847">CSLAddNameValue</a>(papszDSCO, GNM_MD_NAME, <span class="stringliteral">&quot;my_pipes_network&quot;</span>);</div>
<div class="line">    papszDSCO = <a class="code" href="cpl__string_8h.html#a140315b0903d52c438c143894f0d9847">CSLAddNameValue</a>(papszDSCO, GNM_MD_SRS, <span class="stringliteral">&quot;EPSG:4326&quot;</span>);</div>
<div class="line">    papszDSCO = <a class="code" href="cpl__string_8h.html#a140315b0903d52c438c143894f0d9847">CSLAddNameValue</a>(papszDSCO, GNM_MD_DESCR, <span class="stringliteral">&quot;My pipes network&quot;</span>);</div>
<div class="line">    papszDSCO = <a class="code" href="cpl__string_8h.html#a140315b0903d52c438c143894f0d9847">CSLAddNameValue</a>(papszDSCO, GNM_MD_FORMAT, <span class="stringliteral">&quot;ESRI Shapefile&quot;</span>);</div>
<div class="line"></div>
<div class="line"></div>
<div class="line">    <a class="code" href="classGDALDriver.html">GDALDriver</a> *poDriver = <a class="code" href="gdal__priv_8h.html#a4fb74d15f12b1ecd77bd8e5c48086590">GetGDALDriverManager</a>()-&gt;<a class="code" href="classGDALDriverManager.html#ac26308c182440c8abd584040fa89bd4f">GetDriverByName</a>(<span class="stringliteral">&quot;GNMFile&quot;</span>);</div>
<div class="line">    <a class="code" href="classGNMGenericNetwork.html">GNMGenericNetwork</a>* poDS = (<a class="code" href="classGNMGenericNetwork.html">GNMGenericNetwork</a>*) poDriver-&gt;<a class="code" href="classGDALDriver.html#adb7bff9007fa5190d6cf742cf76942a8">Create</a>( <span class="stringliteral">&quot;..\\network_data&quot;</span>, 0, 0, 0, <a class="code" href="gdal_8h.html#a22e22ce0a55036a96f652765793fb7a4aee80d7a2ef95f128685e66f6e1024cbe">GDT_Unknown</a>,</div>
<div class="line">                                                       papszDSCO );</div>
<div class="line">    <a class="code" href="cpl__string_8h.html#a5a39b9c5896a273cc6f06c1d5be93238">CSLDestroy</a>(papszDSCO);</div>
<div class="line">    <span class="keywordflow">if</span> (poDS == NULL)</div>
<div class="line">    {</div>
<div class="line">        printf(<span class="stringliteral">&quot;Failed to create network\n&quot;</span>);</div>
<div class="line">        exit(1);</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <a class="code" href="classGDALDataset.html">GDALDataset</a> *poSrcDS = (<a class="code" href="classGDALDataset.html">GDALDataset</a>*) <a class="code" href="gdal_8h.html#aca05455472359964151f9c891d678d5e">GDALOpenEx</a>(<span class="stringliteral">&quot;..\\in_data&quot;</span>,<a class="code" href="gdal_8h.html#a8253249767721c3e54a4a2844b30f256">GDAL_OF_VECTOR</a> | <a class="code" href="gdal_8h.html#a6a137b58124afec0b1e8d3b7d1bf4cc8">GDAL_OF_READONLY</a>, NULL, NULL, NULL );</div>
<div class="line">    <span class="keywordflow">if</span>(poSrcDS == NULL)</div>
<div class="line">    {</div>
<div class="line">        printf(<span class="stringliteral">&quot;Can not open source dataset at\n&quot;</span>);</div>
<div class="line">        exit(1);</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <a class="code" href="classOGRLayer.html">OGRLayer</a> *poSrcLayer1 = poSrcDS-&gt;<a class="code" href="classGDALDataset.html#a576978fecfad68741b44719605cf637e">GetLayerByName</a>(<span class="stringliteral">&quot;pipes&quot;</span>);</div>
<div class="line">    <a class="code" href="classOGRLayer.html">OGRLayer</a> *poSrcLayer2 = poSrcDS-&gt;<a class="code" href="classGDALDataset.html#a576978fecfad68741b44719605cf637e">GetLayerByName</a>(<span class="stringliteral">&quot;wells&quot;</span>);</div>
<div class="line">    <span class="keywordflow">if</span> (poSrcLayer1 == NULL || poSrcLayer2 == NULL)</div>
<div class="line">    {</div>
<div class="line">        printf(<span class="stringliteral">&quot;Can not process layers of source dataset\n&quot;</span>);</div>
<div class="line">        exit(1);</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    poDS-&gt;<a class="code" href="classGNMGenericNetwork.html#a778b7bf19164768f3f198653c15f6d6c">CopyLayer</a>(poSrcLayer1, <span class="stringliteral">&quot;pipes&quot;</span>);</div>
<div class="line">    poDS-&gt;<a class="code" href="classGNMGenericNetwork.html#a778b7bf19164768f3f198653c15f6d6c">CopyLayer</a>(poSrcLayer2, <span class="stringliteral">&quot;wells&quot;</span>);</div>
<div class="line"></div>
<div class="line">    <a class="code" href="gdal_8h.html#a0984222d45a72028fcbbf1f44831ffbc">GDALClose</a>(poSrcDS);</div>
<div class="line"></div>
<div class="line">    printf(<span class="stringliteral">&quot;\nBuilding network topology ...\n&quot;</span>);</div>
<div class="line">    <span class="keywordtype">char</span> **papszLayers = NULL;</div>
<div class="line">    <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i = 0; i &lt; poDS-&gt;<a class="code" href="classGNMGenericNetwork.html#a60be29b9b6a343bc33fbb160ea4faedd">GetLayerCount</a>(); ++i)</div>
<div class="line">    {</div>
<div class="line">        <a class="code" href="classOGRLayer.html">OGRLayer</a>* poLayer = poDS-&gt;<a class="code" href="classGNMGenericNetwork.html#a5c7fad64871d7d57f579e3865ffd5dc1">GetLayer</a>(i);</div>
<div class="line">        papszLayers = <a class="code" href="cpl__string_8h.html#ae84fb70e547d924b925556b2105714d5">CSLAddString</a>(papszLayers, poLayer-&gt;<a class="code" href="classOGRLayer.html#a287f5ec7728cacc2f7d94882a9f1a22e">GetName</a>() );</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">if</span>(poGenericNetwork-&gt;ConnectPointsByLines(papszLayers, dfTolerance,</div>
<div class="line">                                        dfDirCost, dfInvCost, eDir) != CE_None )</div>
<div class="line">    {</div>
<div class="line">        printf(<span class="stringliteral">&quot;Building topology failed\n&quot;</span>);</div>
<div class="line">        exit(1);</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">else</span></div>
<div class="line">    {</div>
<div class="line">        printf(<span class="stringliteral">&quot;Topology has been built successfully\n&quot;</span>);</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <a class="code" href="classOGRLayer.html">OGRLayer</a> *poNewLayer = poDS-&gt;<a class="code" href="classGDALDataset.html#afec5fd0fffddbdf530cd6294caa66a7d">CreateLayer</a>(<span class="stringliteral">&quot;pumps&quot;</span>, , NULL, <a class="code" href="ogr__core_8h.html#a800236a0d460ef66e687b7b65610f12aa6f8377c5a4a9d36ae2384f4a5f45d77f">wkbPoint</a>, NULL );</div>
<div class="line">    <span class="keywordflow">if</span>( poNewLayer == NULL )</div>
<div class="line">    {</div>
<div class="line">        printf( <span class="stringliteral">&quot;Layer creation failed.\n&quot;</span> );</div>
<div class="line">        exit( 1 );</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <a class="code" href="classOGRFieldDefn.html">OGRFieldDefn</a> fieldDefn (<span class="stringliteral">&quot;pressure&quot;</span>,<a class="code" href="ogr__core_8h.html#a787194bea637faf12d61643124a7c9fca99520e47d9e26303f7c0127c1254c962">OFTReal</a>);</div>
<div class="line">    <span class="keywordflow">if</span>( poNewLayer-&gt;<a class="code" href="classOGRLayer.html#a00b1376a1eabb1298ef278f92f6d84be">CreateField</a>( &amp;fieldDefn ) != <a class="code" href="ogr__core_8h.html#a67a14d8dceb15392134cc51180c5e6f0">OGRERR_NONE</a> )</div>
<div class="line">    {</div>
<div class="line">        printf( <span class="stringliteral">&quot;Creating Name field failed.\n&quot;</span> );</div>
<div class="line">        exit( 1 );</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <a class="code" href="classOGRFeature.html">OGRFeature</a> *poFeature = <a class="code" href="classOGRFeature.html#a0ef4455f24cfbec6cf37110f9116cf15">OGRFeature::CreateFeature</a>(poNewLayer-&gt;<a class="code" href="classOGRLayer.html#a80473bcfd11341e70dd35bebe94026cf">GetLayerDefn</a>());</div>
<div class="line">    <a class="code" href="classOGRPoint.html">OGRPoint</a> pt;</div>
<div class="line">    pt.<a class="code" href="classOGRPoint.html#a0eef5e2d9e0edeca0e0f06c7527facb4">setX</a>(37.291466);</div>
<div class="line">    pt.setY(55.828351);</div>
<div class="line">    poFeature-&gt;<a class="code" href="classOGRFeature.html#a67949569519c0de6ee3ea48f23ff11c9">SetGeometry</a>(&amp;pt);</div>
<div class="line">    <span class="keywordflow">if</span>( poNewLayer-&gt;<a class="code" href="classOGRLayer.html#a5d6db0be3b8876142d54e8bfd5dc8324">CreateFeature</a>( poFeature ) != <a class="code" href="ogr__core_8h.html#a67a14d8dceb15392134cc51180c5e6f0">OGRERR_NONE</a> )</div>
<div class="line">    {</div>
<div class="line">        printf( <span class="stringliteral">&quot;Failed to create feature.\n&quot;</span> );</div>
<div class="line">        exit( 1 );</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    GNMGFID gfid = poFeature-&gt;<a class="code" href="classOGRFeature.html#a696f6e0c7f9a7025020b8ecf71cbd7a8">GetFID</a>();</div>
<div class="line"></div>
<div class="line">    <a class="code" href="classOGRFeature.html#a5d2602d11f21567119da0ca6b6c5ad45">OGRFeature::DestroyFeature</a>( poFeature );</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">if</span> (poDS-&gt;<a class="code" href="classGNMGenericNetwork.html#a75053c44125b84185f6390b7cb994f9e">ConnectFeatures</a>(gfid ,63, -1, 5.0, 5.0, GNMDirection_SrcToTgt) != GNMError_None)</div>
<div class="line">    {</div>
<div class="line">        printf(<span class="stringliteral">&quot;Can not connect features\n&quot;</span>);</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <a class="code" href="gdal_8h.html#a0984222d45a72028fcbbf1f44831ffbc">GDALClose</a>(poDS);</div>
<div class="line">}</div>
</div><!-- fragment --><h1><a class="anchor" id="gnm_tut_analyse"></a>
Analysing networks</h1>
<p>In the second example we will analyse the network which we have built in the first example. We will calculate the shortest path between two points via Dijkstra algorithm performing the feature blockings and saving the resulting path into the file.</p>
<p>Initially we open our network, passing the path to its Shapefile dataset.</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &quot;gnm.h&quot;</span></div>
<div class="line"><span class="preprocessor">#include &quot;gnm_priv.h&quot;</span></div>
<div class="line"></div>
<div class="line"><span class="keywordtype">int</span> main ()</div>
<div class="line">{</div>
<div class="line">    <a class="code" href="gdal_8h.html#a9d40bc998bd6ed07ccde96028e85ae26">GDALAllRegister</a>();</div>
<div class="line"></div>
<div class="line">    <a class="code" href="classGNMGenericNetwork.html">GNMGenericNetwork</a> *poNet = (<a class="code" href="classGNMGenericNetwork.html">GNMGenericNetwork</a>*) <a class="code" href="gdal_8h.html#aca05455472359964151f9c891d678d5e">GDALOpenEx</a>(<span class="stringliteral">&quot;..\\network_data&quot;</span>,<a class="code" href="gdal_8h.html#afc26cc59fc1bf495f3d308f8f311efb1">GDAL_OF_GNM</a> | <a class="code" href="gdal_8h.html#a424cb3d1cf7487511d47a474e7a394ab">GDAL_OF_UPDATE</a>, NULL, NULL, NULL );</div>
<div class="line">    <span class="keywordflow">if</span>(poSrcDS == NULL)</div>
<div class="line">    {</div>
<div class="line">        printf(<span class="stringliteral">&quot;Can not open source dataset at\n&quot;</span>);</div>
<div class="line">        exit(1);</div>
<div class="line">    }</div>
</div><!-- fragment --><p>Before any calculations we open the dataset which will hold the layer with the resulting path.</p>
<div class="fragment"><div class="line"><a class="code" href="classGDALDataset.html">GDALDataset</a> *poResDS;</div>
<div class="line">poResDS = (<a class="code" href="classGDALDataset.html">GDALDataset</a>*) <a class="code" href="gdal_8h.html#aca05455472359964151f9c891d678d5e">GDALOpenEx</a>(<span class="stringliteral">&quot;..\\out_data&quot;</span>,</div>
<div class="line">                                    <a class="code" href="gdal_8h.html#a8253249767721c3e54a4a2844b30f256">GDAL_OF_VECTOR</a> | <a class="code" href="gdal_8h.html#a424cb3d1cf7487511d47a474e7a394ab">GDAL_OF_UPDATE</a>,</div>
<div class="line">                                    NULL, NULL, NULL);</div>
<div class="line"><span class="keywordflow">if</span> (poResDS == NULL)</div>
<div class="line">{</div>
<div class="line">    printf(<span class="stringliteral">&quot;Failed to open resulting dataset\n&quot;</span>);</div>
<div class="line">    exit(1);</div>
<div class="line">}</div>
</div><!-- fragment --><p>Finally we use the Dijkstra shortest path method to calculations. This path will be found passing over the blocked feature and saved into internal memory <a class="el" href="classOGRLayer.html" title="This class represents a layer of simple features, with access methods. ">OGRLayer</a>, which we copy to the real dataset. Now it can be visualized by GIS.</p>
<div class="fragment"><div class="line">    <a class="code" href="classOGRLayer.html">OGRLayer</a> *poResLayer = poNet-&gt;<a class="code" href="classGNMGenericNetwork.html#a922338fd67e1b2a2f5dad873964931b4">GetPath</a>(64, 41, GATDijkstraShortestPath, NULL);</div>
<div class="line">    <span class="keywordflow">if</span> (poResLayer == NULL)</div>
<div class="line">    {</div>
<div class="line">        printf(<span class="stringliteral">&quot;Failed to save or calculate path\n&quot;</span>);</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (poResDS-&gt;<a class="code" href="classGDALDataset.html#afcaabd6468b256fda99bd50db34ceff1">CopyLayer</a>(poResLayer, <span class="stringliteral">&quot;shp_tutorial.shp&quot;</span>) == NULL)</div>
<div class="line">    {</div>
<div class="line">        printf(<span class="stringliteral">&quot;Failed to save path to the layer\n&quot;</span>);</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">else</span></div>
<div class="line">    {</div>
<div class="line">        printf(<span class="stringliteral">&quot;Path saved successfully\n&quot;</span>);</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <a class="code" href="gdal_8h.html#a0984222d45a72028fcbbf1f44831ffbc">GDALClose</a>(poResDS);</div>
<div class="line">    poNet-&gt;<a class="code" href="classGDALDataset.html#ab2c2b105b8f76a279e6a53b9b4a182e0">ReleaseResultSet</a>(poRout);</div>
<div class="line">    <a class="code" href="gdal_8h.html#a0984222d45a72028fcbbf1f44831ffbc">GDALClose</a>(poNet);</div>
<div class="line">}</div>
</div><!-- fragment --><p>All in one block:</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &quot;gnm.h&quot;</span></div>
<div class="line"><span class="preprocessor">#include &quot;gnmstdanalysis.h&quot;</span></div>
<div class="line"></div>
<div class="line"><span class="keywordtype">int</span> main ()</div>
<div class="line">{</div>
<div class="line">    <a class="code" href="gdal_8h.html#a9d40bc998bd6ed07ccde96028e85ae26">GDALAllRegister</a>();</div>
<div class="line"></div>
<div class="line">    <a class="code" href="classGNMGenericNetwork.html">GNMGenericNetwork</a> *poNet = (<a class="code" href="classGNMGenericNetwork.html">GNMGenericNetwork</a>*) <a class="code" href="gdal_8h.html#aca05455472359964151f9c891d678d5e">GDALOpenEx</a>(<span class="stringliteral">&quot;..\\network_data&quot;</span>,</div>
<div class="line">                                                     <a class="code" href="gdal_8h.html#afc26cc59fc1bf495f3d308f8f311efb1">GDAL_OF_GNM</a> | <a class="code" href="gdal_8h.html#a424cb3d1cf7487511d47a474e7a394ab">GDAL_OF_UPDATE</a>,</div>
<div class="line">                                                     NULL, NULL, NULL );</div>
<div class="line">    <span class="keywordflow">if</span>(poSrcDS == NULL)</div>
<div class="line">    {</div>
<div class="line">        printf(<span class="stringliteral">&quot;Can not open source dataset at\n&quot;</span>);</div>
<div class="line">        exit(1);</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <a class="code" href="classGDALDataset.html">GDALDataset</a> *poResDS;</div>
<div class="line">    poResDS = (<a class="code" href="classGDALDataset.html">GDALDataset</a>*) <a class="code" href="gdal_8h.html#aca05455472359964151f9c891d678d5e">GDALOpenEx</a>(<span class="stringliteral">&quot;..\\out_data&quot;</span>,</div>
<div class="line">                                        <a class="code" href="gdal_8h.html#a8253249767721c3e54a4a2844b30f256">GDAL_OF_VECTOR</a> | <a class="code" href="gdal_8h.html#a424cb3d1cf7487511d47a474e7a394ab">GDAL_OF_UPDATE</a>,</div>
<div class="line">                                        NULL, NULL, NULL);</div>
<div class="line">    <span class="keywordflow">if</span> (poResDS == NULL)</div>
<div class="line">    {</div>
<div class="line">        printf(<span class="stringliteral">&quot;Failed to open resulting dataset\n&quot;</span>);</div>
<div class="line">        exit(1);</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    poNet-&gt;<a class="code" href="classGNMGenericNetwork.html#ae715f88098caf13603c44f21475351bf">ChangeBlockState</a>(36, <span class="keyword">true</span>);</div>
<div class="line"></div>
<div class="line">    <a class="code" href="classOGRLayer.html">OGRLayer</a> *poResLayer = poNet-&gt;<a class="code" href="classGNMGenericNetwork.html#a922338fd67e1b2a2f5dad873964931b4">GetPath</a>(64, 41, GATDijkstraShortestPath, NULL);</div>
<div class="line">    <span class="keywordflow">if</span> (poResLayer == NULL)</div>
<div class="line">    {</div>
<div class="line">        printf(<span class="stringliteral">&quot;Failed to save or calculate path\n&quot;</span>);</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (poResDS-&gt;<a class="code" href="classGDALDataset.html#afcaabd6468b256fda99bd50db34ceff1">CopyLayer</a>(poResLayer, <span class="stringliteral">&quot;shp_tutorial.shp&quot;</span>) == NULL)</div>
<div class="line">    {</div>
<div class="line">        printf(<span class="stringliteral">&quot;Failed to save path to the layer\n&quot;</span>);</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">else</span></div>
<div class="line">    {</div>
<div class="line">        printf(<span class="stringliteral">&quot;Path saved successfully\n&quot;</span>);</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <a class="code" href="gdal_8h.html#a0984222d45a72028fcbbf1f44831ffbc">GDALClose</a>(poResDS);</div>
<div class="line">    poNet-&gt;<a class="code" href="classGDALDataset.html#ab2c2b105b8f76a279e6a53b9b4a182e0">ReleaseResultSet</a>(poRout);</div>
<div class="line">    <a class="code" href="gdal_8h.html#a0984222d45a72028fcbbf1f44831ffbc">GDALClose</a>(poNet);</div>
<div class="line">}</div>
</div><!-- fragment --> </div></div><!-- contents -->
<hr>
Generated for GDAL by
<a href="http://www.doxygen.org/index.html"><img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.8.8.
</body>
</html>
